<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用jest + selenium + node.js 搭建自己的自动化测试框架 | 王大娃的博客</title>
    <meta name="description" content="

之前我们学习了如何使用selenium自动化操作浏览器，为了能更方便的管理测试用例，并且更方便的接入市面上好的测试工具，我们需要引入一个工程化的框架，我们选择的是jest框架。

什么是jest

jest 是facebook推出的一款测试框架，集成了 Mocha chai jsdom sinon等功能。

你可以用jest搭建一个独立的自动化测试项目，由测试去主导进 ...">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.0f2dc576.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.ac768c96.js" as="script"><link rel="preload" href="/my-blog/assets/js/6.40cd04e7.js" as="script"><link rel="preload" href="/my-blog/assets/js/4.ccfe9ec8.js" as="script"><link rel="preload" href="/my-blog/assets/js/16.d2cdeb34.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/1.132c05b9.js"><link rel="prefetch" href="/my-blog/assets/js/10.a538b01e.js"><link rel="prefetch" href="/my-blog/assets/js/11.8436d0fc.js"><link rel="prefetch" href="/my-blog/assets/js/12.bd8d3a13.js"><link rel="prefetch" href="/my-blog/assets/js/13.bbe29040.js"><link rel="prefetch" href="/my-blog/assets/js/14.7cdef4fb.js"><link rel="prefetch" href="/my-blog/assets/js/15.c00973ee.js"><link rel="prefetch" href="/my-blog/assets/js/17.5624747e.js"><link rel="prefetch" href="/my-blog/assets/js/18.12f30454.js"><link rel="prefetch" href="/my-blog/assets/js/19.8df87cad.js"><link rel="prefetch" href="/my-blog/assets/js/20.7132aeb7.js"><link rel="prefetch" href="/my-blog/assets/js/21.2b45c40d.js"><link rel="prefetch" href="/my-blog/assets/js/22.ced0d522.js"><link rel="prefetch" href="/my-blog/assets/js/23.38903bb7.js"><link rel="prefetch" href="/my-blog/assets/js/5.7a810208.js"><link rel="prefetch" href="/my-blog/assets/js/7.c31a3c01.js"><link rel="prefetch" href="/my-blog/assets/js/8.8bcef17a.js"><link rel="prefetch" href="/my-blog/assets/js/9.5c6032c8.js"><link rel="prefetch" href="/my-blog/assets/js/vuejs-paginate.caee409a.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.0f2dc576.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/my-blog/" class="nav-link home-link">王大娃的博客 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/my-blog/" class="nav-link">博客</a></li><li class="nav-item"><a href="https://wangbigwa.github.io/my-docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">技术文档</a></li><li class="nav-item"><a href="/my-blog/tag/" class="nav-link">tag</a></li><li class="nav-item"><a href="https://github.com/wangBigWa" target="_blank" rel="noopener noreferrer" class="nav-link external">github</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/my-blog/" class="nav-link mobile-home-link">王大娃的博客 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/my-blog/" class="nav-link">博客</a></li><li class="mobile-nav-item"><a href="https://wangbigwa.github.io/my-docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">技术文档</a></li><li class="mobile-nav-item"><a href="/my-blog/tag/" class="nav-link">tag</a></li><li class="mobile-nav-item"><a href="https://github.com/wangBigWa" target="_blank" rel="noopener noreferrer" class="nav-link external">github</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">wangBigWa</span> <span itemprop="address">   in 深圳</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-4-5">
      Sun Apr 05 2020
    </time></div> <!----></div></header> <div itemprop="articleBody" class="content__default"><h1 id="使用jest-selenium-node-js-搭建自己的自动化测试框架"><a href="#使用jest-selenium-node-js-搭建自己的自动化测试框架" class="header-anchor">#</a> 使用jest + selenium + node.js 搭建自己的自动化测试框架</h1> <p>之前我们学习了如何使用selenium自动化操作浏览器，为了能更方便的管理测试用例，并且更方便的接入市面上好的测试工具，我们需要引入一个工程化的框架，我们选择的是jest框架。</p> <h2 id="什么是jest"><a href="#什么是jest" class="header-anchor">#</a> 什么是jest</h2> <p>jest 是facebook推出的一款测试框架，集成了 <code>Mocha</code> <code>chai</code> <code>jsdom</code> <code>sinon</code>等功能。</p> <ul><li>你可以用jest搭建一个独立的自动化测试项目，由测试去主导进行编码。</li> <li>你也可以将jest集成到已有的前端项目中，由前端去主导，一边开发页面，一边开发UI测试代码</li></ul> <h2 id="安装与配置"><a href="#安装与配置" class="header-anchor">#</a> 安装与配置</h2> <div class="language- extra-class"><pre class="language-text"><code>npm i jest -g 或者
yarn add jest -g
</code></pre></div><p>安装后，主要的目录是tests，里面用来存放用例文件，以*.test.js的格式命名</p> <div class="language- extra-class"><pre class="language-text"><code>└─ tests
   └─ order.test.js
   └─ login.test.js
</code></pre></div><p>编写用例文件后，如果要运行这些用例，使用命令</p> <div class="language- extra-class"><pre class="language-text"><code>npm run test
</code></pre></div><p>它会执行tests文件夹中所有<code>.test.js</code>文件，并且在控制台中输出测试报告，或者脚本错误</p> <h2 id="jest和selenium"><a href="#jest和selenium" class="header-anchor">#</a> jest和selenium</h2> <p>jest是一个测试框架，而selenium是用来操作浏览器的工具，要在jest框架中使用selenium，则需要安装<code>selenium-webdriver</code>，并且在package.json中进行相应的配置，比如使用的浏览器，匹配的测试用例路径等</p> <div class="language- extra-class"><pre class="language-text"><code>npm i -S selenium-webdriver
</code></pre></div><p>package.json的jest相关配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;verbose&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;setupFilesAfterEnv&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./jasmine.config.js&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testEnvironment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest-environment-webdriver&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testEnvironmentOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chrome&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testMatch&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;**/tests/**.test.js&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="与直接使用selenium的区别"><a href="#与直接使用selenium的区别" class="header-anchor">#</a> 与直接使用selenium的区别</h3> <p>jest会调起<code>webdriver</code>的中间件(jest-environment-webdriver)，设置一些全局别名，可以直接调用，不用再去new了</p> <ul><li>browser — 全局浏览器引用</li> <li>by — By()的别名</li> <li>element — Driver#findElement()的别名</li> <li>element.all — Driver#findElements()的别名</li> <li>until — until的别名(不变,只是不需要导入了)</li></ul> <h3 id="接下来我们看一个测试脚本"><a href="#接下来我们看一个测试脚本" class="header-anchor">#</a> 接下来我们看一个测试脚本</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试下单'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// 设置最大化好像费时较长，如果不延长超时时长，很容易会报错</span>
		<span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">manage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://ht-materialoperator-test.htmimi.com/operator/user/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'登录运营商后台测试环境-切换到验证码登录'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> verifyTabEl <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">findElements</span><span class="token punctuation">(</span>by<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'.ant-tabs-tab'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> verifyTabEl<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> activeTabEl <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span>by<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'.ant-tabs-tab-active'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token keyword">await</span> activeTabEl<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 断言要用await</span>
		<span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'验证码登录'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'填写用户名和验证码'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> userNameEl <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span>by<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'userName'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> codeEl <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span>by<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> userNameEl<span class="token punctuation">.</span><span class="token function">sendKeys</span><span class="token punctuation">(</span><span class="token string">'13250593421'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> codeEl<span class="token punctuation">.</span><span class="token function">sendKeys</span><span class="token punctuation">(</span><span class="token string">'111206'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// test第三个参数是当前用例的超时时长，默认是5000ms，如果用例需要等待时间超过该设定值，会报错</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'点击登录'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> buttonEl <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">findElement</span><span class="token punctuation">(</span>by<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'.ant-btn.antd-pro-components-login-index-submit'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> buttonEl<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>until<span class="token punctuation">.</span><span class="token function">urlContains</span><span class="token punctuation">(</span><span class="token string">'operator/home'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>describe用来对用例进行分组，可以理解为一个测试流程。每个test.js文件中只能有1个describe方法。</li> <li>beforeAll是一个钩子函数，是在当前describe中，所有用例执行之前触发。在上面例子中，在该钩子函数中，我们打开并最大化浏览器，然后跳转到一个地址。</li> <li>由于selenium的浏览器操作是异步的，且有明显的前后顺序，所以我们使用es6的async/await语法，进行异步方法的等待。</li> <li>需要注意的是，beforeAll的第三个参数，传入的是一个时间间隔，单位为毫秒。它表示当前方法可以执行的最大时间间隔，如果超过这个时间，则整个用例报错，并中断执行。如果不设置，则取默认值5000。所以，当一个用例的操作时间很长的情况下，需要将这个值设置大一些。</li> <li>test和beforeAll都有上述的问题。</li> <li>每一个test中可以写断言，用来判断当前执行的结果有没有问题，如果有错，会记录到测试报告中去。</li></ul> <h2 id="生成测试报告"><a href="#生成测试报告" class="header-anchor">#</a> 生成测试报告</h2> <p>如果要生成测试报告，则使用另一个命令</p> <div class="language- extra-class"><pre class="language-text"><code>npm run coverage
</code></pre></div><p>该命令会执行测试用例，并生成测试报告</p> <p>关于更多selenium的操作方法，请移步我的<a href="https://wangbigwa.github.io/my-docs/document/selenium-with-node.html" target="_blank" rel="noopener noreferrer">selenium+node.js中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#什么是jest" title="什么是jest">什么是jest</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#安装与配置" title="安装与配置">安装与配置</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#jest和selenium" title="jest和selenium">jest和selenium</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#与直接使用selenium的区别" title="与直接使用selenium的区别">与直接使用selenium的区别</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#接下来我们看一个测试脚本" title="接下来我们看一个测试脚本">接下来我们看一个测试脚本</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#生成测试报告" title="生成测试报告">生成测试报告</a></div></div></div></div> <footer class="footer" data-v-f0201fb2><div class="footer-left-wrap" data-v-f0201fb2><ul class="contact" data-v-f0201fb2></ul></div> <div class="footer-right-wrap" data-v-f0201fb2><ul class="copyright" data-v-f0201fb2></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/my-blog/assets/js/app.ac768c96.js" defer></script><script src="/my-blog/assets/js/6.40cd04e7.js" defer></script><script src="/my-blog/assets/js/4.ccfe9ec8.js" defer></script><script src="/my-blog/assets/js/16.d2cdeb34.js" defer></script>
  </body>
</html>
